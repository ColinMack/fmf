var fund_data = {
    "464288596": {
        "1/1/2017": 113.21,
        "1/2/2017": 112.46,
        "1/3/2017": 111.72,
        "1/4/2017": 110.97,
        "1/5/2017": 110.23,
        "1/6/2017": 109.48,
        "1/7/2017": 109.48,
        "1/8/2017": 109.48,
        "1/9/2017": 107.24,
        "1/10/2017": 106.5,
        "1/11/2017": 105.75,
        "1/12/2017": 105.01,
        "1/13/2017": 105.9,
        "1/14/2017": 105.9,
        "1/15/2017": 105.9,
        "1/16/2017": 108.58,
        "1/17/2017": 109.48,
        "1/18/2017": 110.37,
        "1/19/2017": 111.27,
        "1/20/2017": 112.16,
        "1/21/2017": 112.16,
        "1/22/2017": 112.16,
        "1/23/2017": 114.84,
        "1/24/2017": 115.74,
        "1/25/2017": 116.63,
        "1/26/2017": 117.52,
        "1/27/2017": 118.42,
        "1/28/2017": 118.42,
        "1/29/2017": 118.42,
        "1/30/2017": 121.1,
        "1/31/2017": 121.99,
        "2/1/2017": 122.89,
        "2/2/2017": 123.78,
        "2/3/2017": 124.68,
        "2/4/2017": 124.68,
        "2/5/2017": 124.68,
        "2/6/2017": 127.36,
        "2/7/2017": 128.25,
        "2/8/2017": 129.15,
        "2/9/2017": 130.04,
        "2/10/2017": 130.93,
        "2/11/2017": 130.93,
        "2/12/2017": 130.93,
        "2/13/2017": 133.62,
        "2/14/2017": 134.51,
        "2/15/2017": 135.4,
        "2/16/2017": 136.3,
        "2/17/2017": 137.19,
        "2/18/2017": 137.19,
        "2/19/2017": 137.19,
        "2/20/2017": 139.88,
        "2/21/2017": 140.77,
        "2/22/2017": 141.66,
        "2/23/2017": 141.25,
        "2/24/2017": 140.83,
        "2/25/2017": 140.83,
        "2/26/2017": 140.83,
        "2/27/2017": 139.58,
        "2/28/2017": 139.16,
        "3/1/2017": 140.1,
        "3/2/2017": 141.04,
        "3/3/2017": 141.98,
        "3/4/2017": 141.98,
        "3/5/2017": 141.98,
        "3/6/2017": 144.79,
        "3/7/2017": 145.73,
        "3/8/2017": 146.66,
        "3/9/2017": 147.6,
        "3/10/2017": 148.54
      },
    "464287291": {
        "1/1/2017": 120.17,
        "1/2/2017": 119.42,
        "1/3/2017": 118.68,
        "1/4/2017": 117.93,
        "1/5/2017": 117.19,
        "1/6/2017": 116.44,
        "1/7/2017": 116.44,
        "1/8/2017": 116.44,
        "1/9/2017": 114.2,
        "1/10/2017": 113.46,
        "1/11/2017": 112.71,
        "1/12/2017": 111.97,
        "1/13/2017": 112.86,
        "1/14/2017": 112.86,
        "1/15/2017": 112.86,
        "1/16/2017": 115.54,
        "1/17/2017": 116.44,
        "1/18/2017": 117.33,
        "1/19/2017": 118.23,
        "1/20/2017": 119.12,
        "1/21/2017": 119.12,
        "1/22/2017": 119.12,
        "1/23/2017": 121.8,
        "1/24/2017": 122.7,
        "1/25/2017": 123.59,
        "1/26/2017": 124.48,
        "1/27/2017": 125.38,
        "1/28/2017": 125.38,
        "1/29/2017": 125.38,
        "1/30/2017": 128.06,
        "1/31/2017": 128.95,
        "2/1/2017": 129.85,
        "2/2/2017": 130.74,
        "2/3/2017": 131.64,
        "2/4/2017": 131.64,
        "2/5/2017": 131.64,
        "2/6/2017": 134.32,
        "2/7/2017": 135.21,
        "2/8/2017": 136.11,
        "2/9/2017": 137,
        "2/10/2017": 137.89,
        "2/11/2017": 137.89,
        "2/12/2017": 137.89,
        "2/13/2017": 140.58,
        "2/14/2017": 141.47,
        "2/15/2017": 142.36,
        "2/16/2017": 143.26,
        "2/17/2017": 144.15,
        "2/18/2017": 144.15,
        "2/19/2017": 144.15,
        "2/20/2017": 146.84,
        "2/21/2017": 147.73,
        "2/22/2017": 148.62,
        "2/23/2017": 148.21,
        "2/24/2017": 147.79,
        "2/25/2017": 147.79,
        "2/26/2017": 147.79,
        "2/27/2017": 146.54,
        "2/28/2017": 146.12,
        "3/1/2017": 147.06,
        "3/2/2017": 148,
        "3/3/2017": 148.94,
        "3/4/2017": 148.94,
        "3/5/2017": 148.94,
        "3/6/2017": 151.75,
        "3/7/2017": 152.69,
        "3/8/2017": 153.62,
        "3/9/2017": 154.56,
        "3/10/2017": 155.5
    },
    "464285105": {
        "1/1/2017": 12.04,
        "1/2/2017": 11.29,
        "1/3/2017": 10.55,
        "1/4/2017": 9.8,
        "1/5/2017": 9.06,
        "1/6/2017": 8.31,
        "1/7/2017": 8.31,
        "1/8/2017": 8.31,
        "1/9/2017": 6.07,
        "1/10/2017": 5.33,
        "1/11/2017": 4.58,
        "1/12/2017": 3.84,
        "1/13/2017": 4.73,
        "1/14/2017": 4.73,
        "1/15/2017": 4.73,
        "1/16/2017": 7.41,
        "1/17/2017": 8.31,
        "1/18/2017": 9.2,
        "1/19/2017": 10.1,
        "1/20/2017": 10.99,
        "1/21/2017": 10.99,
        "1/22/2017": 10.99,
        "1/23/2017": 13.67,
        "1/24/2017": 14.57,
        "1/25/2017": 15.46,
        "1/26/2017": 16.35,
        "1/27/2017": 17.25,
        "1/28/2017": 17.25,
        "1/29/2017": 17.25,
        "1/30/2017": 19.93,
        "1/31/2017": 20.82,
        "2/1/2017": 21.72,
        "2/2/2017": 22.61,
        "2/3/2017": 23.51,
        "2/4/2017": 23.51,
        "2/5/2017": 23.51,
        "2/6/2017": 26.19,
        "2/7/2017": 27.08,
        "2/8/2017": 27.98,
        "2/9/2017": 28.87,
        "2/10/2017": 29.76,
        "2/11/2017": 29.76,
        "2/12/2017": 29.76,
        "2/13/2017": 32.45,
        "2/14/2017": 33.34,
        "2/15/2017": 34.23,
        "2/16/2017": 35.13,
        "2/17/2017": 36.02,
        "2/18/2017": 36.02,
        "2/19/2017": 36.02,
        "2/20/2017": 38.71,
        "2/21/2017": 39.6,
        "2/22/2017": 40.49,
        "2/23/2017": 40.08,
        "2/24/2017": 39.66,
        "2/25/2017": 39.66,
        "2/26/2017": 39.66,
        "2/27/2017": 38.41,
        "2/28/2017": 37.99,
        "3/1/2017": 38.93,
        "3/2/2017": 39.87,
        "3/3/2017": 40.81,
        "3/4/2017": 40.81,
        "3/5/2017": 40.81,
        "3/6/2017": 43.62,
        "3/7/2017": 44.56,
        "3/8/2017": 45.49,
        "3/9/2017": 46.43,
        "3/10/2017": 47.37
    }
}

var colors = ["#27AFAF", "#82bc00", "#0081C9", "#006747", "#0093639", "#B4DB0A", "#FFCC00", "#FCD015", "#CB333B", "#671E75"]

var loadLineGraph = function(data, category){
    $("#lineGraph svg").empty();

    var ports = data.contents;

    var first_cusip = Object.keys(fund_data)[0];
    var dates = Object.keys(fund_data[first_cusip]).slice(Object.keys(fund_data[first_cusip]).length-10, Object.keys(fund_data[first_cusip]).length);

    var graphData = [];
    _.each(dates, function(date, index){
        var date_val = {};
        var val = 0;
        _.each(ports, function(port, index){
            val += port.shares*fund_data[port.cusip][date];
        });
        var date=date.split("/");
        date_val["date"] = new Date(date[2], date[0]-1, date[1]);
        date_val["val"] = val;
        graphData.push(date_val);
    });


    var svg = d3.select("#lineGraph svg"),
    margin = {top: 20, right: 20, bottom: 30, left: 50},
    width = +svg.attr("width") - margin.left - margin.right,
    height = +svg.attr("height") - margin.top - margin.bottom,
    g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");


    var x = d3.scaleTime()
        .rangeRound([0, width]);

    var y = d3.scaleLinear()
        .rangeRound([height, 0]);

    var parseTime = d3.timeParse("%d/%b/%y");


    var line = d3.line()
        .x(function(d) { return x(d.date); })
        .y(function(d) { return y(d.val); });




        x.domain(d3.extent(graphData, function(d) { return d.date; }));
        y.domain(d3.extent(graphData, function(d) { return d.val; }));

        g.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x))
        .select(".domain")
          .remove();

        g.append("g")
          .call(d3.axisLeft(y))
        .append("text")
          .attr("fill", "#000")
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", "0.71em")
          .attr("text-anchor", "end")
          .text("Price ($)");

        g.append("path")
          .datum(graphData)
          .attr("fill", "none")
          .attr("stroke", "rgb(130, 188, 0)")
          .attr("stroke-linejoin", "round")
          .attr("stroke-linecap", "round")
          .attr("stroke-width", 1.5)
          .attr("d", line);

        var rectangle = svg.append("rect")
            .attr("x", margin.left)
            .attr("y", margin.top)
            .attr("width", width)
            .attr("height", height)
            .style('opacity', 0.5)
            .style('fill', '#ebf0f2');

      

};
